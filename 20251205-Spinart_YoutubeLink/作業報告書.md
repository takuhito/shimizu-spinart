# 作業報告書：YouTube Shorts対応および再構築エラー修正

| URL | 説明 |
| --- | --- |
| [spinart.jp](https://www.spinart.jp) | メインサイト |
| [MovableType](https://www.spinart.jp/mt/mt.cgi) | MovableType管理画面 |

## 1. 概要
MovableTypeのテンプレートにおいて、以下の課題を解決しました。
1.  **YouTube Shorts対応**: 通常のURL、ShortsのURL、短縮URL（youtu.be）など、あらゆる形式のYouTubeリンクを自動的に埋め込み動画（iframe）に変換して表示するようにしました。
2.  **再構築エラーの解消**: 複雑なMTタグによる再構築エラーを回避するため、動画埋め込みロジックをJavaScriptベースに移行しました。
3.  **記事テンプレートの修正**: `記事テンプレート.html` における再構築エラー（コンテンツタイプが見つからない）の原因となっていた記述ミスを修正しました。

## 2. 対応ファイル
以下の2ファイルに対して修正・実装を行いました。
- `新ファイル.html` （コンテンツタイプ用テンプレート） [実際のファイル](./新ファイル.html) | [MovableTypeテンプレート : 連載記事ページ](https://www.spinart.jp/mt/mt.cgi?__mode=view&_type=template&id=17&blog_id=1)
- `記事テンプレート.html` （記事用テンプレート） [実際のファイル](./記事テンプレート.html) | [MovableTypeテンプレート : 記事](https://www.spinart.jp/mt/mt.cgi?__mode=view&published=1&blog_id=1&id=49&_type=template&saved=1)

## 3. 実装内容の詳細

### 3.1 JavaScriptベースの動画埋め込みロジック
MovableTypeのタグ（MTML）のみで複雑なURL解析を行うと、再構築エラーや構文エラーが発生しやすいため、**「値の出力はMTタグ、解析と表示はJavaScript」**という役割分担を行いました。

**仕組み:**
1.  **MTタグ**: 動画フィールドの値（URLやiframeタグ）を、非表示のHTML要素（`<div class="js-video-raw" style="display:none;">...</div>`）に出力します。
2.  **JavaScript**: ページ読み込み時に、上記の値を取得し、以下の処理を行います。
    *   **iframeタグの場合**: そのまま表示します（既存の埋め込みコードとの互換性維持）。
    *   **URLの場合**: URLから動画IDを抽出し、レスポンシブ対応のYouTube埋め込みコード（iframe）を生成して表示します。

**メリット:**
*   **安定性**: 再構築時に複雑な処理を行わないため、エラーが発生しません。
*   **柔軟性**: YouTubeのURL形式（`youtube.com/watch?v=...`、`youtu.be/...`、`youtube.com/shorts/...`）を問わず対応可能です。

### 3.2 記事テンプレートの修正
`記事テンプレート.html` の再構築時に「コンテンツタイプが見つからない」というエラーが発生していました。

**原因:**
`mt:Contents` タグの `content_type` 属性に不要なスペースが含まれていました。
*   誤: `content_type=" サイト基本情報"`
*   正: `content_type="サイト基本情報"`

**対応:**
ファイル内の該当箇所（12行目、41行目）を修正し、エラーを解消しました。

## 4. 確認事項
*   **表示確認**: `新ファイル.html` および `記事テンプレート.html` で、YouTube動画が正しく表示されることを確認しました。
*   **再構築確認**: 両テンプレートにおいて、エラーなく再構築が完了することを確認しました。

以上となります。
